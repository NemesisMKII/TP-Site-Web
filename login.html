<!DOCTYPE html>
<html lang="fr" class="">
<head>
	<meta charset="utf-8" />
	<title>Login</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
		  integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
</head>
<body>


<button id="btnConnexion">
	Test
</button>

<div class="modal" id="modalLogin">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Connectez-vous</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="btnClose"></button>
			</div>
			<div class="modal-body">
				<form action="" class="text-center" id="formLogin">
					<input type="text" class="m-2" placeholder="identifiant" id="myID"><br>
					<input type="password" class="m-2" placeholder="mot de passe" id="myPassword"><br>
					<input type="submit" class="btn btn-danger m-2" value="Connexion">
				</form>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<script>

$("#btnConnexion").click(function() {

	$("#modalLogin").modal("show")				//affiche le formulaire de connexion sous forme de modal
	$("#formLogin").submit(function(event) {
		event.preventDefault()
		var pseudo = $("#myID").val()			//recup le pseudo
		var MdP = $("#myPassword").val()		//recup le mot de passe
		login (pseudo, MdP)						//lance la fonction Login
	})
})

$("#btnClose").click(function () {		//fermeture du formulaire de connection au clic sur X en haut a droite
	$("#modalLogin").hide()
})

function login(pseudo, MdP) {
	console.log("login enclenché")
	var monJsonUsers								//recup du Json dans localStorage
	if (!localStorage.getItem("localUsers")) {		//si vide, creation d'un nouveau Json
		monJsonUsers = {"users": [{"pseudo" : "Zlatan",
									"mdp" : "123",
									"role" : "larbin"}]}
	} else {
		monJsonUsers = JSON.parse(localStorage.getItem("localUsers"))
	}

	if (pseudo == "" || MdP == "") {			//verif que les input pseudo et mot de passe sont rempli
		alert("Merci de remplir les 2 champs")
	} else {
		var pseudoExist = false
		let x									//recherche du pseudo dans le Json
		for (x in monJsonUsers.users) {
			if (pseudo == monJsonUsers.users[x].pseudo) {	//pseudo OK
				var monUser = monJsonUsers.users[x]
				pseudoExist = true
				break
			} else {										//pseudo non trouvé
				alert("Mauvaise identification, essayez encore")
				location.reload()
			}
		}
	}
	if (pseudoExist) {
		var loginOK = false
		if (MdP == monUser.mdp) {							//MdP correspond au pseudo
			alert("Content de vous revoir " + monUser.pseudo)
			loginOK = true
			sessionStorage.setItem("sessionUser", JSON.stringify(monUser))	//Stockage de l'user dans le sessionStorage
			$("#modalLogin").hide()
																		//charger le theme s'il existe
																		//modifier le bouton "connection" en déconnection et créer la fonction
		} else {
			alert("Mauvaise identification, essayez encore")
			location.reload()
		}
		if (loginOK) {						//pseudo + MdP OK => verif si Admin ou User
			if (monUser.role == "admin") {
				// Mode Admin
				alert("Mode Admin enclenché")
			} else {
				// User Normal
				alert("Mode Boudoir déverrouillé")
			}
		}
	}
}

</script>
</body>
</html>